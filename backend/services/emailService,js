// services/emailService.js
const nodemailer = require('nodemailer');

class EmailService {
  constructor() {
    this.transporter = nodemailer.createTransport({
      host: process.env.EMAIL_HOST,
      port: process.env.EMAIL_PORT,
      secure: true,
      auth: {
        user: process.env.EMAIL_USER,
        pass: process.env.EMAIL_PASSWORD
      }
    });
  }

  // Send welcome email
  async sendWelcomeEmail(user) {
    const mailOptions = {
      from: '"SwoleMates" <noreply@swolemates.com>',
      to: user.email,
      subject: 'Welcome to SwoleMates! üí™',
      html: `
        <h1>Welcome to SwoleMates, ${user.name}!</h1>
        <p>We're excited to have you join our fitness community.</p>
        <p>Start swiping to find your perfect workout buddy!</p>
        <a href="${process.env.CLIENT_URL}" style="background: #7c3aed; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; display: inline-block; margin-top: 20px;">
          Get Started
        </a>
      `
    };

    await this.transporter.sendMail(mailOptions);
  }

  // Send match notification email
  async sendMatchEmail(user, matchedUser) {
    const mailOptions = {
      from: '"SwoleMates" <noreply@swolemates.com>',
      to: user.email,
      subject: 'You have a new match! üéâ',
      html: `
        <h1>New Match!</h1>
        <p>You matched with ${matchedUser.name}!</p>
        <p>Start chatting and schedule your first workout together.</p>
        <a href="${process.env.CLIENT_URL}/matches">View Match</a>
      `
    };

    await this.transporter.sendMail(mailOptions);
  }

  // Send workout reminder
  async sendWorkoutReminder(user, workout) {
    const mailOptions = {
      from: '"SwoleMates" <noreply@swolemates.com>',
      to: user.email,
      subject: 'Workout Reminder üèãÔ∏è',
      html: `
        <h1>Workout Reminder</h1>
        <p>Don't forget your workout with ${workout.buddy.name}!</p>
        <p><strong>Time:</strong> ${workout.time}</p>
        <p><strong>Location:</strong> ${workout.gym}</p>
      `
    };

    await this.transporter.sendMail(mailOptions);
  }
}

module.exports = new EmailService();